# docker镜像

### 1.什么是镜像

镜像其实就是容器的只读型的模板，他包含了文件系统，代码，依赖项等等所有要运行容器的环境，我们可以通过镜像来创建容器，运行容器，从而完成我们要完成的任务。

### 2.镜像是怎么加载的呢

我们的镜像一般是从dockerhub上下载来的，在我们使用docker pull命令的时候，我们会发现他的下载方式和其他文件系统的下载方式是不一样的,我们叫他分层下载。

```shell
[root@mantouCentOS7 ~]# docker pull mysql
Using default tag: latest
latest: Pulling from library/mysql
fcbdc4090331: Pull complete #分层下载
95eb5073c36f: Pull complete 
5e5ba0e6412a: Pull complete 
ee4654eb29b7: Pull complete 
1d2218160b86: Pull complete 
bbe712936412: Pull complete 
4a6efa152609: Pull complete 
0f7c3b67bb2b: Pull complete 
7ccd17e83c8a: Pull complete 
04bf2c116556: Pull complete 
Digest: sha256:4a4e5e2a19aab7a67870588952e8f401e17a330466ecfc55c9acf51196da5bd0
Status: Downloaded newer image for mysql:latest
docker.io/library/mysql:latest  #真实地址
```

**为什么要用分层下载呢？**

其实这要从他的文件系统说起，docker使用的文件系统是**联合文件系统(UnionFS)**，什么是联合文件系统呢？它允许将多个不同的文件系统（称为分支或层）合并在一起，形成一个单一的虚拟文件系统。在联合文件系统中，多个分支的文件和目录被透明地合并在一起，用户可以像访问单一文件系统一样访问这些文件和目录。简单来说你有两个文件夹，一个是A文件夹，另一个是B文件夹。A文件夹中有文件X和文件Y，B文件夹中有文件Z。通过使用联合文件系统，你可以将这两个文件夹合并为一个文件夹C。现在，当你查看文件夹C时，你会看到文件X、文件Y和文件Z，就好像它们都在同一个文件夹里。例如我们在下载MySQL的时候，docker先会查看MySQL的元数据里都有哪些层，随后一层一层的从docker的仓库里下载到本地。

言归正传，为什么要分层下载？也就是为什么docker要使用联合文件系统。

1. 当然是节省空间。要知道docker是一个轻量级的容器技术。其实很多镜像都是有相同的组成部分的，比如mysql8.0肯定包含很多mysql5.0的文件，换句话说，mysql8.0和mysql5.0有相同的层，这样我们使用联合文件系统共享他们共有的文件，节省了不同镜像所需相同文件所花费的开销。

2. 版本控制系统（如Git）：在版本控制系统中，联合文件系统可以用于合并不同分支的代码。例如，当你切换到某个分支时，联合文件系统会将该分支的代码和文件与主分支的代码合并在一起，形成一个临时的虚拟文件系统。这使得你可以在切换分支时快速查看和比较不同分支的文件变化。

3. 安全性和隔离性：联合文件系统可以用于实现安全性和隔离性，例如在虚拟化环境中。不同的虚拟机可以使用联合文件系统将它们的文件和资源隔离开来，使得它们彼此独立，并且在一个虚拟机中的修改不会影响到其他虚拟机或宿主系统。

### 制作一个镜像

docker commit 命令 提交一个容器为新的镜像到本地

`docker commit -m="提交的描述" -a="作者" [容器id] [生成镜像的名字]:[tag版本]`

实例

我们的docker下载的tomcat中的webapps是空的，内容都在webapps.dist 中，我们要重新制作一个镜像，要webapps中有内容

1. docker pull tomcat下载一个tomcat镜像

2. docker run -d tomcat 后台运行这个tomcat镜像

3. docker exec -it 25042bb0c82c  /bin/bash 进入这个容器

4.  cp -r webapps.dist/* webapps 将webapps.dist 的内容复制到webapps

5. ctrl + q+p退出容器

6. docker commit -m="newtomcat" -a="xxx" 25042bb0c82c new_tomcat:1.0 提交容器为镜像

7. docker images 查看这个镜像
   
   ```shell
   [root@mantouCentOS7 ~]# docker images
   REPOSITORY            TAG       IMAGE ID       CREATED         SIZE
   new_tomcat            1.0       85edcedcd5cf   6 seconds ago   460MB
   tomcat                latest    5a4ee0c8ccbe   12 days ago     455MB
   hello-world           latest    d2c94e258dcb   12 months ago   13.3kB
   portainer/portainer   latest    5f11582196a4   18 months ago   287MB
   centos                latest    5d0da3dc9764   2 years ago     231MB
   
   
   ```


